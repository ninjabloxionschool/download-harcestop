<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Téléchargement en cours…</title>

  <!-- Police Figtree -->
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300..900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="wrap">
    <h1>Votre téléchargement va commencer...</h1>
    <div class="loader" aria-hidden="true"></div>
    <p id="msg">
      Si le téléchargement ne démarre pas automatiquement, 
      <a id="fallback" href="https://github.com/ninjabloxionschool/download-harcestop/releases/download/Stable/Harcestop-win32-x64.zip" download>
        cliquez ici pour télécharger
      </a>.
    </p>
  </main>

  <!-- iframe caché pour déclencher le téléchargement -->
  <div id="hidden-container" style="width:0;height:0;overflow:hidden;position:fixed;left:-9999px;top:-9999px;">
    <iframe id="download-iframe" src="" style="border:0;width:0;height:0;"></iframe>
  </div>

  <script>
    const DOWNLOAD_URL = "https://github.com/ninjabloxionschool/download-harcestop/releases/download/Stable/Harcestop-win32-x64.zip";
    
    // Mettre le lien de secours à jour
    document.getElementById("fallback").href = DOWNLOAD_URL;

    // Fonction pour lancer le téléchargement
    function startBackgroundDownload(url) {
      try {
        // 1) Télécharger via iframe caché
        const iframe = document.getElementById("download-iframe");
        iframe.src = url;

        // 2) Aussi créer un lien invisible et le "cliquer" pour forcer le navigateur
        const a = document.createElement("a");
        a.href = url;
        a.download = "";
        a.style.display = "none";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) {
        console.error("Erreur download background:", e);
      }
    }

    // Lancer le téléchargement dès que la page est chargée
    window.addEventListener("load", () => {
      setTimeout(() => startBackgroundDownload(DOWNLOAD_URL), 300);
    });
  </script>
</body>
</html>
